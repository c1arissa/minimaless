---
layout: post
title: "Windows Exploitation"
author: Clarissa Podell
categories: write-up
tags: exploit windows
---

# Objective

To exploit an indirect forward-edge control flow transfer on a binary compiled with Microsoft's Control Flow Guard.

# Vulnerability

<pre><code style="line-height:0;">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#define STDIN 0

void jmptarget();
void calltarget(int,int,int);

struct data {
	char buf[1024];
	int arg1;
	int arg2;
	int arg3;
	void (*jmpPtr)();
	void (*callPtr)(int, int, int);
};

void overflow() {
	struct data mydata;
	mydata.jmpPtr = jmptarget;
	mydata.callPtr = &calltarget;
	printf("0x%08x\n", (unsigned int)&mydata.buf);
	printf("\ndata&gt; ");
	read(STDIN, mydata.buf, 2048);
	printf("\n");

	__asm
	{
		push mydata.arg3
		push mydata.arg2
		push mydata.arg1
		call mydata.callPtr
		add esp, 12
	}

	__asm
	{
		jmp mydata.jmpPtr
	}
	printf("?\n");

	label:
	   printf("label reached\n");
}

void jmptarget() {
	printf("jmptarget() called\n");
}

void calltarget(int arg1, int arg2, int arg3) {
	printf("calltarget() called (args: %x, %x, %x)\n",
		arg1, arg2, arg3);
}

int main(int argc, char* argv[]) {
	setbuf(stdout, NULL);
	overflow();
	printf("\ndone.\n");
	return 0;
}</code></pre>

# Exploit
